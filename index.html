<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Launamyndir</title>
  <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic" rel="stylesheet" type="text/css">-->
  
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
  <style>
    h2 {
        color: black;
        text-align: center;
      }

      .axis {
        font-family: arial;
        font-size: 0.8em;
      }

      path {
        fill: none;
        stroke: black;
        stroke-width: 2px;
      }

      .tick {
        fill: none;
        stroke: black;
      }

      circle {
        opacity: 1;
        stroke: black;
        stroke-width: 1;
       
      }
      rect {
        opacity: 1;
        stroke: black;
        stroke-width: 1;
      }

      .line_plot {
        fill: none;
        stroke: #4eb0bb;
        stroke-width: 1px;
      }
      .label {
        width: 150px;
        color: black;
        text-align: left;
      }
      div.left: {
        width: 80%;
        float: left;
      }
      div.right {
        width: 20%;
      }
      .container {
        display: flex;
        flex-direction: row;
      }
      body {
      background-color: rgba(224,243,248,1);/*#61CDF5;#f1f1f2;*/
      color: black;
    }
    div.main {
      margin-top: 1%;
      margin-left: 3%;
      margin-right: 3%;
    }
    div.tafla {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    div.tafla2 {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    div.tafla3 {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    div.tafla5 {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    h4.fyrirsogn
    {
      padding-left: 3%;
    }
    div.carosel-container {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap; 
      justify-content: space-around;
    }
    div.hd {
      width: 10%;
      padding-left: 2%;
      padding-right: 2%;
    }
    div.yfirtafla {
      background-color: white;
      padding: 1%;
      border: 1px solid rgba(0,0,0,0.1);

    }
    .young {
      background-color: rgba(215,48,39,0.4);
    }
    .young2 {
      background-color: rgba(252,141,89,0.4);
    }
    .middle {
      background-color: rgba(254,224,144,0.4);
    }
    .middle2 {
      background-color: rgba(224,243,248,0.4);
    }
    .old {
      background-color: rgba(145,191,219,0.4);
    }
    .old2 {
      background-color: rgba(69,117,180,0.4);
    }
    .well  {
      background-color: #ffffff;
      background-image: none;
      padding-left: 2%;
      padding-right: 2%;
      padding-top: 1%;
     
    }
    .well {
      border: 1px solid #666;
    
    }
    .well > p {
       font-size: 20px;
    }
    a {
      color: rgba(69,117,180,1);
      font-size: 24px;
    }
    a:hover {
      background-color: transparent;
    }
    .nav-tabs {
      border-bottom: 1px solid #666;
    }
    .nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
      color: #666;
      background-color: #fff;
      border: 1px solid #666;
      border-bottom-color: transparent;
      cursor: default;
    }
    div.fyrirsogn {
      padding-left: 1%;
    }
    div.takkar {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    div.takki {
      
    }
    h1.nemfjoldi {
      text-align: center;
    }
    div.takki {
      border-style: solid;
    }
    .panel-title {
      font-size: 24px;
    }
    table.narrow {
      width: 80%;
    }
    div.panel-body {
      padding-left: 5%;
      padding-right: 5%;

    }
    div.well-lg {
      padding-left: 5%;
      padding-right: 5%;

    }
    svg {
      width: 100%;
    }
    path.line {
        fill: none;
        stroke: gray;
        opacity: 0.5;
        stroke-width: 1px;
    }
  </style>
  <body>
    <div class="container">
        <div class="yfirtafla">
          <div class="takkar">
            <div class="btn-group btn-group-justified" role="group" aria-label="...">
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" id="fjorir2">4 hópar</button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" id="fimm2">5 hópar</button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" aria-label="left" id="minnka2">
                  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary takki" aria-label="right" id="haekka2">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>    
          <div id="teikniflotur2">
          </div>
        </div>
    </div>
    <div class="container">
        <div class="yfirtafla">
          <div class="takkar">
            <div class="btn-group btn-group-justified" role="group" aria-label="...">
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" id="fjorir1">4 hópar</button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" id="fimm1">5 hópar</button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" aria-label="left" id="minnka1">
                  <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                </button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary takki" aria-label="right" id="haekka1">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>    
          <div id="teikniflotur1">
          </div>
        </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.3.13/d3.js"></script>
  <!--<script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>-->
  <script src="init2.js"></script>
  <script type="text/javascript">
      var nemfjoldisbr2 = 15;
      var afangafjoldisbr2 = 4;

      function draw(data) {
        "use strict";
          var tooltip = d3.select("body")
            .append("div")
            .attr("class","label")
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden")
            .style("background-color","#fdae6b")
            .text("");


          // manipulating data
          var data2 = data.map(function(d) {
            var vidmid = data.filter(kennari => kennari.afangafjoldi == d.afangafjoldi && kennari.launaflokkur == "5" && kennari.synidaemi == d.synidaemi && kennari.nemendafjoldi == d.nemendafjoldi);
            if (vidmid.length == 1) {
              var referenceSalary = parseFloat(vidmid[0].laun);
              d.mismunur = (parseFloat(d.laun/referenceSalary)-1)*100;
            }
            else {
              var referenceSalary = (parseFloat(vidmid[0].laun) + parseFloat(vidmid[1].laun))/2;
              d.mismunur = (parseFloat(d.laun/referenceSalary)-1)*100;
            }
            return d;
          }); 


          
          var update = function(nemfjoldi,afangafjoldi,mynd,data) {
            
            
            mynd.right_header.text("Fjöldi " + nemfjoldi);
            mynd.right_header2.text("Hópar " + afangafjoldi);

            var filtered = data.filter(d => (d.nemendafjoldi == (nemfjoldi + "") || d.synidaemi == "2013") && d.afangafjoldi == (afangafjoldi + "")); 
            
            var circles = mynd.teikniflotur.selectAll("circle").data(filtered, function(d) {
              return d['key'];
            });

            circles.exit().remove();
            circles.enter().append("circle")
            .attr('cx',mynd2.x)
            .attr('cy',function(d) {
              return mynd2.percentage_scale(d['mismunur']);
            })
            .attr('r',5)
            .attr('fill',function(d) {
              var aldurslitir = {
                '30 ára-': "#d7191c",
                '30-37 ára': "#fdae61",
                '38-54 ára':  "#ffffbf",
                '55-59 ára': "#abd9e9",
                '60 ára+': "#2c7bb6"
              };
              return aldurslitir[d['aldursflokkur']];
            })
            .attr("transform", "translate(50,0)")
            .attr("id",function(d) {
              return d['key'] + "";
            })
            .on("mouseover", function(item) {
              var id = this.id;
              mynd.tooltipFunction(tooltip,data,id,item);
            })
            .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
            .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
        
          };// end of update
          update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);
          
          $('#minnka2').on('click', function () {
            if (nemfjoldisbr2 > 15) {
              nemfjoldisbr2 -= 1;
              update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);
            }
            else {
             nemfjoldisbr2 = 15;
             update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);

            }
          });
          $('#haekka2').on('click', function () {
            if (nemfjoldisbr2 < 32) {
              nemfjoldisbr2 += 1;
              update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);

            }
            else {
              nemfjoldisbr2 = 32;
              update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);
            }
          });  
          $('#fjorir2').on('click', function () {
            afangafjoldisbr2 = 4;
            update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);
          });
          $('#fimm2').on('click', function () {
            afangafjoldisbr2 = 5;
            update(nemfjoldisbr2,afangafjoldisbr2,mynd2,data2);

          });
        };//end of draw
        

    
  </script>
  <script type="text/javascript">
    d3.tsv("/data/kjaramal.tsv",draw);
  </script>
</html>
